new entry "SYR_Feat_ShieldMaster_ShieldBash"
type "PassiveData"
data "DisplayName" "h60a1fe6dgda93g42f0gbd32g3ced36868396;1"
data "Description" "had60299cg1956g46a9g883fg336567b6f76c;1"
data "DescriptionParams" "DealDamage(1d4,Force)"
data "Icon" "PassiveFeature_ShieldMaster_Shove"
data "Properties" "Highlighted"
data "Boosts" "IF(HasShieldEquipped() and not HasStatus('SG_Incapacitated')):RollBonus(SavingThrow,2,Dexterity);UnlockInterrupt(SYR_Interrupt_ShieldMaster_ShieldBlow);IF(not HasPassive('MAG_Legendary_ShieldRiposte_Passive',context.Source) and not HasPassive('MAG_ShieldRiposte_Passive',context.Source)):UnlockInterrupt(Interrupt_ShieldBlow)"

new entry "SYR_Interrupt_ShieldMaster_ShieldBlow"
type "InterruptData"
data "DisplayName" "hd76b36a5g1c13g465bg8942g443a9cc16d6b;1"
data "Description" "h607840d3gfa5cg44e4gbd04g838f46d9b7f1;1"
data "Icon" "SYR_Spell_ShieldBash"
data "InterruptContext" "OnEnterAttackRange"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and not Self(context.Observer, context.Target) and HasShieldEquipped(context.Observer) and Enemy() and not (HasStatus('MOBILE_NO_AOO', context.Source) and HasStatus('MOBILE_NO_AOO_SOURCE', context.Target)) and not HasStatus('SNEAKING',context.Target) and not HasStatus('SG_Ignore_AOO',context.Target) and not HasStatus('SYR_SHIELD_MASTER_SHIELD_BLOW_COOLDOWN',context.Source) and not AnyEntityIsItem()"
data "Properties" "UseSpell(Target_ShieldBlow_Riposte,true,true,true);ApplyStatus(OBSERVER_OBSERVER,INTERRUPT_RIPOSTE,100,0);ApplyStatus(OBSERVER_OBSERVER,SYR_SHIELD_MASTER_SHIELD_BLOW_COOLDOWN,100,1)"
data "Cooldown" "OncePerTurn"
data "Stack" "AttackOfOpportunity"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "not HasAnyStatus({'SG_Polymorph','SG_Blinded'}) or Tagged('MINDFLAYER') or HasStatus('SG_Disguise')"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"

new entry "SYR_SHIELD_MASTER_SHIELD_BLOW_COOLDOWN"
type "StatusData"
data "StatusType" "BOOST"
data "StackId" "SYR_FEAT_PERFORMER_COOLDOWN"
data "StatusPropertyFlags" "DisableCombatlog;DisableOverhead;DisablePortraitIndicator"

new entry "Target_ShieldBlow_Riposte"
type "SpellData"
data "SpellType" "Target"
using "Target_ShieldBlow_Riposte"
data "DisplayName" "hd76b36a5g1c13g465bg8942g443a9cc16d6b;1"
data "Description" "h4c61fb89g3b71g4597g8c5bg83b556b0ac1f;1"
data "Icon" "SYR_Spell_ShieldBash"
data "SpellRoll" "not SavingThrow(Ability.Strength, HybridCasterWeaponActionDC())"
data "SpellSuccess" "ApplyStatus(PRONE,100,1);Force(0.5);IF(HasPassive('ShieldMaster_PassiveBonuses',context.Source)):DealDamage(1d4,Force,Nonmagical,,0,,true,true,false,true);IF(HasPassive('ShieldMaster_PassiveBonuses',context.Source) and HasPassive('MAG_Legendary_ShieldRiposte_Passive',context.Source)):DealDamage(3d4,Force,Nonmagical,,0,,true,true,false,true);ApplyStatus(SYR_SHIELD_BASH_HIT_VFX,100,0)"
data "SpellFail" "IF(HasPassive('ShieldMaster_PassiveBonuses',context.Source) and HasPassive('MAG_Legendary_ShieldRiposte_Passive',context.Source)):DealDamage(3d4/2,Force,Nonmagical,,0,,true,true,false,true);IF(not HasPassive('ShieldMaster_PassiveBonuses',context.Source) and HasPassive('MAG_Legendary_ShieldRiposte_Passive',context.Source)):DealDamage(2d4/2,Force,Nonmagical,,0,,true,true,false,true);ApplyStatus(SYR_SHIELD_BASH_MISS_VFX,100,0)"
data "AlternativeCastTextEvents" ""
data "TooltipAttackSave" "Strength"
//AlternativeCastTextEvents breaks shield blow

new entry "Target_Legendary_ShieldBlow_Riposte"
type "SpellData"
data "SpellType" "Target"
using "Target_ShieldBlow_Riposte"
data "SpellSuccess" "IF(not HasPassive('ShieldMaster_PassiveBonuses',context.Source)):DealDamage(2d4, Force);IF(HasPassive('ShieldMaster_PassiveBonuses',context.Source)):DealDamage(3d4,Force);ApplyStatus(PRONE,100,1);ApplyStatus(SYR_SHIELD_BASH_HIT_VFX,100,0)"
data "SpellFail" "IF(not HasPassive('ShieldMaster_PassiveBonuses',context.Source)):DealDamage(2d4/2, Force);IF(HasPassive('ShieldMaster_PassiveBonuses',context.Source)):DealDamage(3d4/2,Force);ApplyStatus(SYR_SHIELD_BASH_MISS_VFX,100,0)"
data "AlternativeCastTextEvents" ""

//Vanilla shield blow
new entry "Interrupt_ShieldBlow"
type "InterruptData"
using "Interrupt_ShieldBlow"
data "DisplayName" "h05eeafb4g31bdg451fgbcfcgf65e377c41d2;1"
data "Description" "hf5fc5ea9g4125g4804ga9d4g6b047cfeb6c2;1"
data "DescriptionParams" "DealDamage(1d4,Force)"

new entry "MAG_ShieldRiposte_Passive"
type "PassiveData"
using "MAG_ShieldRiposte_Passive"
data "Description" "h7e075a69g6fc7g46c1gbf67g8110aa4be773;1"
data "DescriptionParams" "DealDamage(1d4,Force)"

//Viconia's shield blow
new entry "Interrupt_Legendary_ShieldBlow"
type "InterruptData"
using "Interrupt_Legendary_ShieldBlow"
data "Description" "h2051c38cgad75g400dgae02g2fdc407e0d67;1"
data "DescriptionParams" "DealDamage(2d4,Force);DealDamage(3d4,Force)"
data "ExtraDescription" ""

new entry "MAG_Legendary_ShieldRiposte_Passive"
type "PassiveData"
using "MAG_Legendary_ShieldRiposte_Passive"
data "Description" "h912c7db4g9ea0g416aga7edg2e991c3ecd24;1"
data "DescriptionParams" "DealDamage(2d4,Force);DealDamage(3d4,Force)"


new entry "SYR_SHIELD_BASH_HIT_VFX"
type "StatusData"
data "StatusType" "BOOST"
data "StackId" "SYR_SHIELD_BASH_HIT_VFX"
data "StatusPropertyFlags" "DisableCombatlog;DisableOverhead;DisablePortraitIndicator"
data "StatusEffect" "VFX_Enemies_Alioramus_Bite_Impact_BodyFX_01;Dummy_BodyFX;VFX_Enemies_Panther_Pounce_Impact_01:Dummy_BodyFX"

new entry "SYR_SHIELD_BASH_MISS_VFX"
type "StatusData"
data "StatusType" "BOOST"
data "StackId" "SYR_SHIELD_BASH_MISS_VFX"
data "StatusPropertyFlags" "DisableCombatlog;DisableOverhead;DisablePortraitIndicator"
data "StatusEffect" "VFX_Enemies_DisplacerBeast_Tentacle_Impact_BodyFX_01:Dummy_BodyFX"
